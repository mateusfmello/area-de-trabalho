---
-   name: Instalação do Oh My ZSH
    hosts: localhost
    gather_facts: true
    become: true

    vars:
        ohmyzsh_install_url: "https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh"

    tasks:
        -   name: Gerando diretório temporário
            ansible.builtin.tempfile:
                state: directory
                suffix: ohmyzsh
            register: tempdir_ohmyzsh
    
        -   name: Instalando dependências
            ansible.builtin.apt:
                name:
                    - curl
                    - wget
                    - git
                    - zsh
                state: present

        -   name: Baixar script de instalação do Oh My Zsh
            ansible.builtin.get_url:
                url: "{{ ohmyzsh_install_url }}"
                dest: "{{ tempdir_ohmyzsh.path }}"
                mode: '0777'
                force: yes

        -   name: Ajustar permissões do diretório temporário
            ansible.builtin.file:
                path: "{{ tempdir_ohmyzsh.path }}"
                recurse: true
                mode: '0777'
                
        -   name: Executar script de instalação em modo unattended
            become: true
            become_user: "{{ usuario_sistema }}"
            ansible.builtin.command: "sh {{ tempdir_ohmyzsh.path }}/install.sh --unattended"

        -   name: Definir ZSH como shell padrão
            ansible.builtin.user:
                name: "{{ usuario_sistema }}"
                shell: /bin/zsh


    

    

    
