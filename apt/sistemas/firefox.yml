---
-   name: Instalação do Firefox
    hosts: localhost
    gather_facts: no
    become: true

    tasks:
        -   name: Create a directory if it does not exist
            ansible.builtin.file:
                path: /opt/firefox-developer
                state: directory
                mode: '0755'

        -   name: Criando diretório temporário
            ansible.builtin.tempfile:
                state: directory
                suffix: firefox-developer
            register: tmp_dir
    
        -   name: Extraindo Firefox
            ansible.builtin.unarchive:
                remote_src: yes
                src: https://download.mozilla.org/?product=firefox-devedition-latest-ssl&os=linux64&lang=pt-BR
                dest: "{{ tmp_dir.path }}"

        -   name: Copiado arquivos
            ansible.builtin.copy:
               src: "{{ tmp_dir.path }}/firefox/*"
               dest: /opt/firefox-developer/

        -   name: Disponibilizando binário do Firefox para usuários
            ansible.builtin.file:
                src: /opt/firefox-developer/firefox-bin
                dest: /usr/local/bin/firefox-developer
                owner: nobody
                group: nogroup
                state: link

        -   name: Adicionando Firefox nas aplicações
            ansible.builtin.file:
                src: "{{ playbook_dir }}/../../configuracoes/firefox-developer.desktop"
                dest: /usr/share/applications/firefox-developer.desktop
                owner: nobody
                group: nogroup
                state: link
                force: yes
        
        -   name: Deletando diretório temporário
            ansible.builtin.file:
                path: "{{ tmp_dir.path }}"
                state: absent
